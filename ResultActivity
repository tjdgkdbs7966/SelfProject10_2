package com.example.cookandroidtest


import android.content.Intent
import android.os.Bundle
import android.widget.Button
import android.widget.ImageView
import android.widget.RatingBar
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity

class ResultActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.result)
        title = "투표 결과"

        val intent: Intent = intent
        val voteResult = intent.getIntArrayExtra("VoteCount") ?: IntArray(9)
        val imageName = intent.getStringArrayExtra("ImageName") ?: arrayOf()

        val imageFileId = arrayOf(
            R.drawable.pic1, R.drawable.pic2, R.drawable.pic3,
            R.drawable.pic4, R.drawable.pic5, R.drawable.pic6,
            R.drawable.pic7, R.drawable.pic8, R.drawable.pic9
        )

        val tvTop: TextView = findViewById(R.id.tvTop)
        val ivTop: ImageView = findViewById(R.id.ivTop)

        // 최고 득표 찾기
        var maxEntry = 0
        for (i in 1 until voteResult.size) {
            if (voteResult[i] > voteResult[maxEntry]) {
                maxEntry = i
            }
        }

        tvTop.text = imageName[maxEntry]
        ivTop.setImageResource(imageFileId[maxEntry])

        // TextView와 RatingBar 배열 준비
        val tv = arrayOfNulls<TextView>(imageName.size)
        val rbar = arrayOfNulls<RatingBar>(imageName.size)

        val tvID = arrayOf(
            R.id.tv1, R.id.tv2, R.id.tv3, R.id.tv4, R.id.tv5,
            R.id.tv6, R.id.tv7, R.id.tv8, R.id.tv9
        )

        val rbarID = arrayOf(
            R.id.rbar1, R.id.rbar2, R.id.rbar3, R.id.rbar4, R.id.rbar5,
            R.id.rbar6, R.id.rbar7, R.id.rbar8, R.id.rbar9
        )

        // findViewById로 연결
        for (i in voteResult.indices) {
            tv[i] = findViewById(tvID[i])
            rbar[i] = findViewById(rbarID[i])
        }

        // 값 설정
        for (i in voteResult.indices) {
            tv[i]?.text = imageName[i]
            rbar[i]?.rating = voteResult[i].toFloat()
        }

        // 뒤로가기 버튼
        val btnReturn: Button = findViewById(R.id.btnReturn)
        btnReturn.setOnClickListener {
            finish()
        }
    }
}
